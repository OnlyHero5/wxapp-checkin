<view class="page page-home">

  <view class="content">
    <view wx:if="{{!isOnline}}" class="network-banner">当前无网络，无法签到</view>

    <view class="header">
      <text class="title">活动签到</text>
      <view class="title-line"></view>
    </view>

    <t-cell-group class="card info-card">
      <t-cell title="活动" note="{{activity.activity_title || '—'}}" />
      <t-cell title="身份" note="{{name}} · {{studentId}}" />
      <t-cell title="二维码有效期" note="{{activity.qr_expire_seconds || 10}} 秒" />
    </t-cell-group>

    <view class="btn-center">
      <t-button theme="primary" class="btn-primary" loading="{{loading}}" disabled="{{!isOnline || loading}}" bindtap="onScan">
        {{loading ? '正在验证...' : '扫码签到'}}
      </t-button>
    </view>
    <text class="hint subtle">二维码每 10 秒更新，过期将判无效</text>

    <t-cell-group class="status-card" wx:if="{{lastStatus}}">
      <t-cell title="{{lastStatus.title}}" note="{{lastStatus.message}}" />
      <t-cell wx:if="{{lastStatus.meta}}" title="记录号" note="{{lastStatus.meta}}" />
    </t-cell-group>
  </view>

  <view class="success-overlay" wx:if="{{showSuccess}}" bindtap="closeSuccess">
    <view class="success-card">
      <view class="checkmark"></view>
      <text class="status-title">签到成功</text>
      <text class="status-message">记录已保存，可在签到记录查看</text>
      <t-button theme="default" class="btn-ghost" bindtap="goRecords">查看记录</t-button>
    </view>
  </view>
</view>
