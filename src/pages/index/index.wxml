<view class="page page-home">

  <view class="content">
    <view wx:if="{{!isOnline}}" class="network-banner">当前无网络，无法签到</view>

    <view class="header">
      <text class="title">活动签到</text>
      <view class="title-line"></view>
    </view>

    <ant-container className="card info-card">
      <view class="info-row">
        <text class="label">活动</text>
        <text class="value">{{activity.activity_title || '—'}}</text>
      </view>
      <view class="divider"></view>
      <view class="info-row">
        <text class="label">身份</text>
        <text class="value">{{name}} · {{studentId}}</text>
      </view>
      <view class="info-row">
        <text class="label">二维码有效期</text>
        <text class="value">{{activity.qr_expire_seconds || 10}} 秒</text>
      </view>
    </ant-container>

    <ant-button type="primary" className="btn-primary" loading="{{loading}}" disabled="{{!isOnline || loading}}" bindtap="onScan">
      {{loading ? '正在验证...' : '扫码签到'}}
    </ant-button>
    <text class="hint subtle">二维码每 10 秒更新，过期将判无效</text>

    <ant-container className="status-card" wx:if="{{lastStatus}}">
      <text class="status-title">{{lastStatus.title}}</text>
      <text class="status-message">{{lastStatus.message}}</text>
      <text class="status-meta" wx:if="{{lastStatus.meta}}">{{lastStatus.meta}}</text>
    </ant-container>
  </view>

  <view class="success-overlay" wx:if="{{showSuccess}}" bindtap="closeSuccess">
    <ant-container className="success-card">
      <view class="checkmark"></view>
      <text class="status-title">签到成功</text>
      <text class="status-message">记录已保存，可在签到记录查看</text>
      <ant-button type="light" className="btn-ghost" bindtap="goRecords">查看记录</ant-button>
    </ant-container>
  </view>
</view>
