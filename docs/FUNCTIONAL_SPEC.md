# 微信小程序活动二维码签到功能说明书

文档版本: v1.0  
状态: 草案  
编写日期: 2026-02-03  
项目: wxapp-checkin  
依据: `REQUIREMENTS.md`

## 1. 目的
本文档描述微信小程序“活动二维码签到”功能的详细行为、页面与交互、异常处理及与后端 API 的协作方式，用于指导前端实现与后端对接。

## 2. 目标与非目标
目标:
- 支持用户完成微信身份与学号姓名绑定
- 支持滚动二维码签到并校验有效性
- 提供签到记录查看与保存凭证
- 现代化 UI，极简科技美学

非目标:
- 活动管理后台
- 后端存储结构与运维部署

## 3. 术语与定义
- 微信身份: 由后端通过微信登录凭证解析得到的用户标识
- 绑定: 微信身份与学号姓名建立唯一关联
- 滚动二维码: 每 10 秒变化一次的二维码内容
- 签到记录: 成功签到的活动凭证

## 4. 用户画像与使用场景
用户画像:
- 学生参与者，使用微信小程序完成签到与保存凭证

主要场景:
- 首次使用，完成注册绑定
- 活动现场扫码签到
- 会后查看签到记录并截图保存

## 5. 页面与功能模块

### 5.1 注册绑定页
入口:
- 首次进入且未绑定时自动跳转
- 个人中心入口

功能:
- 获取微信身份信息并显示“已识别”状态
- 输入学号、姓名
- 提交绑定（加密）
- 成功后跳转签到页或首页

交互细节:
- 学号、姓名必填
- 提交时显示加载
- 失败提示具体原因

异常:
- 无网络: 提示不可注册
- 身份获取失败: 提示重试

### 5.2 签到页
入口:
- 主导航默认页

功能:
- 扫码获取二维码内容
- 调用后端校验有效性与身份
- 成功动画与提示

交互细节:
- 扫码按钮为主操作
- 扫码成功后自动请求验证
- 请求中显示加载状态
- 成功后展示动画 + 活动信息
- 失败展示错误原因并提供重试

失败类型提示:
- 二维码过期
- 重复签到
- 身份不匹配
- 网络异常

### 5.3 签到记录页
入口:
- 个人中心或底部导航

功能:
- 列表展示签到记录
- 进入详情页展示完整信息
- 提示用户可截图保存

列表字段:
- 活动名称
- 签到时间
- 地点

详情字段:
- 活动名称
- 时间
- 地点
- 描述（如有）

### 5.4 无网络提示
规则:
- 监听网络状态
- 无网时顶部或弹窗提示
- 禁用签到与注册操作

## 6. 功能流程

### 6.1 注册绑定流程
1. 前端调用登录接口获取 `session_token`
2. 用户输入学号、姓名
3. 前端加密学号姓名 + 微信身份
4. 调用注册 API
5. 成功 -> 存储绑定状态并跳转

### 6.2 签到流程
1. 用户扫码获得 `qr_token`
2. 前端携带身份与学号姓名提交验证
3. 后端返回校验结果
4. 成功 -> 动画 + 记录信息
5. 失败 -> 提示原因

### 6.3 记录查看流程
1. 前端请求签到记录列表
2. 用户点击进入详情
3. 展示完整信息与截图引导

## 7. 业务规则
- 二维码 10 秒更换一次，过期必须判无效
- 同一用户同一活动只能签到一次
- 不限制签到地点

## 8. API 协作要求

### 8.1 登录换取身份
- `POST /api/auth/wx-login`
- 请求: `wx_login_code`
- 响应: `wx_identity`, `session_token`

### 8.2 注册绑定
- `POST /api/register`
- 请求: `session_token`, `student_id`, `name`, `payload_encrypted`
- 响应: `status`, `message`

### 8.3 签到验证
- `POST /api/checkin/verify`
- 请求: `session_token`, `qr_token`, `student_id`, `name`
- 响应: `status`, `message`, `checkin_record_id`

### 8.4 签到记录列表
- `GET /api/checkin/records`
- 请求: `session_token`
- 响应: `records` (id, time, location, activity_title)

### 8.5 签到记录详情
- `GET /api/checkin/records/{record_id}`
- 响应: `time`, `location`, `activity_title`, `description`

### 8.6 当前活动
- `GET /api/activity/current`
- 响应: `activity_title`, `description`, `qr_expire_seconds`

## 9. 数据处理与安全
- 敏感数据仅通过 HTTPS 传输
- 绑定信息需加密后提交
- 前端不持久化保存明文身份信息

## 10. UI 规范
- 风格: 极简科技感，采用“石墨雾”深色体系
- 组件: TDesign（腾讯官方）或等价组件
- 视觉要素: 清晰留白、低对比层次、精确排版、简洁图标
- 动效: 签到成功动画，轻量过渡

## 11. 异常与提示
- 网络不可用: 提示无法签到
- 后端超时: 提示重试
- 身份错误: 引导重新绑定

## 12. 验收标准
- 可完成绑定与验证
- 扫码签到成功
- 失效二维码提示无效
- 重复签到提示已签到
- 身份不匹配提示验证失败
- 记录页可查看时间地点活动内容
- 无网络提示可见

## 13. 待确认问题
- 微信身份具体字段范围与展示方式
- 加密算法与密钥分发方案
- 学号姓名是否允许修改与频率限制
- 是否支持多活动并行签到
- 签到记录分页与保留周期

## 14. 更新记录
- 2026-02-04：组件库调整为 TDesign；视觉主题更新为“石墨雾”，主按钮为深蓝并居中；构建流程改为 `src/` 下安装与 DevTools 构建。
