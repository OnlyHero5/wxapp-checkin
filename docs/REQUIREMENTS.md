# 微信小程序活动二维码签到需求文档

文档版本: v1.0  
状态: 草案  
编写日期: 2026-02-03  
项目: wxapp-checkin  

## 1. 背景与目标
本项目为微信小程序前端，实现基于滚动二维码的活动签到能力。目标是提供安全、简洁、现代化的签到体验，并与后端接口对接完成身份绑定与签到验证。

## 2. 范围
范围内:
- 微信小程序前端页面与交互
- 与后端 API 的对接协议需求
- 视觉与交互规范

范围外:
- 后端服务具体实现与运维
- 活动创建与管理后台

## 3. 角色与用户
主要用户:
- 参与活动的学生用户

相关干系人:
- 活动组织者
- 后端开发
- 设计与产品负责人

## 4. 约束与假设
- 运行环境为微信小程序
- 活动二维码为滚动二维码，10 秒更换一次
- 不限制签到地点
- 签到不允许重复
- 无网络时应提示不可签到
- 需使用现代化组件库，优先 Ant Design 体系
- 视觉参考“月之暗面官网”的极简科技风

## 5. 业务流程概述
流程 1: 注册绑定  
用户在小程序内完成微信身份识别，输入学号与姓名，前端加密后提交后端完成绑定。

流程 2: 扫码签到  
用户扫描活动二维码，前端携带身份与学号姓名调用后端验证，成功则完成签到。

流程 3: 查看记录  
用户查看签到记录列表与详情，可截图保存凭证。

## 6. 功能需求

### 6.1 身份与注册
- FR-001 小程序需获取微信身份信息并用于绑定
- FR-002 用户输入学号与姓名完成注册绑定
- FR-003 前端需对绑定数据进行加密后提交后端保存
- FR-004 注册成功后需有明确提示
- FR-005 注册失败需展示可理解的错误提示

### 6.2 扫码签到
- FR-006 支持扫码识别二维码内容
- FR-007 前端需调用后端验证二维码是否有效
- FR-008 前端需提交微信身份信息 + 学号 + 姓名用于验证
- FR-009 后端返回重复签到时前端需提示不可重复
- FR-010 后端返回二维码失效时需提示无效签到
- FR-011 签到成功需播放成功动画

### 6.3 签到记录
- FR-012 提供签到记录页
- FR-013 签到记录需包含时间、地点、活动内容
- FR-014 记录数据由后端 API 提供
- FR-015 提供截图保存提示或引导

### 6.4 网络与异常
- FR-016 监听网络状态，无网时提示不可签到
- FR-017 请求失败需给出重试入口或提示

### 6.5 UI 与视觉
- FR-018 使用 Ant Design 体系或等价现代化组件库
- FR-019 UI 采用极简科技美学，参考“月之暗面官网”风格
- FR-020 重要操作需清晰的状态反馈

## 7. 非功能需求
- NFR-001 页面加载时间不超过 2 秒（普通网络条件）
- NFR-002 签到请求响应时间目标小于 3 秒
- NFR-003 兼容微信小程序主流版本
- NFR-004 传输过程使用 HTTPS
- NFR-005 不在本地明文持久化存储敏感身份信息

## 8. 数据与安全要求
- 用户身份信息应最小化采集
- 学号与姓名作为绑定信息需加密传输
- 加密算法与密钥分发方式需与后端确认
- 前端仅保存必要的会话标识或短期缓存

## 9. 后端 API 需求

### 9.1 获取身份会话
用途: 获取微信身份凭证，用于后续注册和签到  
接口: `POST /api/auth/wx-login`  
请求字段:
- `wx_login_code` 微信登录临时凭证  
响应字段:
- `wx_identity` 后端解析后的身份标识  
- `session_token` 前端调用后续接口的会话令牌  

### 9.2 注册绑定
用途: 绑定微信身份与学号姓名  
接口: `POST /api/register`  
请求字段:
- `session_token`  
- `student_id`  
- `name`  
- `payload_encrypted` 加密后的绑定数据  
响应字段:
- `status` `success` 或 `fail`  
- `message`  

### 9.3 签到验证
用途: 验证二维码有效性与身份匹配  
接口: `POST /api/checkin/verify`  
请求字段:
- `session_token`  
- `qr_token` 扫码得到的二维码内容  
- `student_id`  
- `name`  
响应字段:
- `status` `success` `invalid_qr` `duplicate` `identity_mismatch`  
- `message`  
- `checkin_record_id` 成功时返回  

### 9.4 签到记录列表
用途: 获取用户签到记录列表  
接口: `GET /api/checkin/records`  
请求字段:
- `session_token`  
响应字段:
- `records`  
- `record_id`  
- `time`  
- `location`  
- `activity_title`  

### 9.5 签到记录详情
用途: 获取单条记录详情  
接口: `GET /api/checkin/records/{record_id}`  
响应字段:
- `time`  
- `location`  
- `activity_title`  
- `description`  

### 9.6 当前活动信息
用途: 提供活动展示与二维码有效期提示  
接口: `GET /api/activity/current`  
响应字段:
- `activity_title`  
- `description`  
- `qr_expire_seconds` 默认 10  

## 10. 业务规则
- 二维码 10 秒更换一次，过期二维码签到必须返回无效
- 同一用户同一活动只能签到一次
- 不基于地理位置限制签到

## 11. 交互与动画要求
- 签到成功有明确动画反馈
- 签到失败有明确原因提示
- 关键状态变化需有过渡或加载提示

## 12. 验收标准
- 能完成注册绑定并成功保存
- 扫码签到成功时有动画反馈
- 失效二维码提示无效
- 重复签到提示已签到
- 身份不匹配提示验证失败
- 签到记录页可查看时间、地点、活动内容
- 无网络状态提示不可签到

## 13. 未决问题
- 微信身份信息具体字段范围
- 加密算法与密钥分发方案
- 是否支持多活动并行签到
- 签到记录保留周期与分页规则
